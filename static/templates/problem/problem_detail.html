{% extends "base/base.html" %}

{% block extra_head %}
    <link href="{{ static('css/problem/problem_detail.css') }}" rel="stylesheet" />
    <script type="text/x-mathjax-config">MathJax.Hub.Config({showProcessingMessages: false,messageStyle: "none",extensions: ["tex2jax.js"],jax: ["input/TeX", "output/HTML-CSS"],tex2jax: {inlineMath:  [ ["$", "$"] ],displayMath: [ ["$$","$$"] ],skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code','a'],ignoreClass:"comment-content"},"HTML-CSS": {availableFonts: ["STIX","TeX"],}});MathJax.Hub.Queue(["Typeset",MathJax.Hub]);</script>
    <script type="text/javascript" src="{{ static('/mathjax/MathJax-2.7.4/MathJax.js') }}"></script>
{% endblock extra_head %}

{% block title %}
    <title> Lutece | {{prob.title}} </title>
{% endblock title %}

{% block content %}
    <div class = 'problem detail'>
        <div class = 'summary'>
            <h1 class = 'ui header'>{{prob.title}}</h1>
            <div class = 'limit'><b>TimeLimit: {{prob.time_limit}} Milliseconds</b></div>
            <div class = 'limit'><b>MemoryLimit: {{prob.memory_limit}} Megabytes</b></div>
            <div class = 'menu'>
                <div class = 'ui basic primary submit button'><i class = 'location arrow icon'></i><b>Submit</b></div>
                <div class = 'ui basic secondary status button'><i class = 'signal icon'></i><b>Status</b></div>
                {% if perms.problem.change_problem %}
                    <div class = 'ui basic orange edit button'><i class = 'edit icon'></i><b>Edit</b></div>
                {% endif %}
            </div>
        </div>
        <div class = 'body'>
            <p class = 'content'> {{ prob.content_markdown | safe }} </p>
            <h2 class= 'ui header'>Standard Input</h2>
            <p class = 'content'>{{ prob.standard_input_markdown | safe }}</p>
            <h2 class= 'ui header'>Standard Output</h2>
            <p class = 'content'>{{prob.standard_output_markdown | safe }}</p>
            {% if  prob.constraints|length > 0  %}
                <h2 class='ui header'> Constraints </h2>
                <p class='content'>{{prob.constraints_markdown | safe }}</p>
            {% endif%}

            <h2 class= 'ui header'>Sample</h2>
                <table class="ui table" >
                        <thead>
                            <tr>
                                <th> Input </th>
                                <th> Output </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for it in sample %}
                                <tr>
                                    <td>{{it.input_content}}</td>
                                    <td>{{it.output_content}}</td>
                                </tr>
                            {% endfor%}
                        </tbody>
                </table>
            {% if  prob.sample_explanation|length > 0  %}
                <h2 class='ui header'>Note</h2>
                <p class='content'>{{prob.sample_explanation}}</p>
            {% endif%}

            {% if  prob.resource|length > 0  %}
                <h2 class='ui header'>Resource</h2>
                <p class='content'>{{prob.resource}}</p>
            {% endif%}
        </div>

        <div id = "submit_modal" class="ui submit modal">
            <div class = 'ui middle aligned center header'>
                Submit
            </div>
            <textarea spellcheck = "false" id='code_textarea'></textarea>
            <div id="bottom_menu">
                <div id = "languagelist" class="ui language selection dropdown">
                    <i class="dropdown icon"></i>
                    <div class="submit language text">{{support_lang.0}}</div>
                    <div class="menu">
                        {% for it in support_lang %}
                            <div class="item">{{it}}</div>
                        {% endfor %}
                    </div>
                </div>
                <div id = "code_submit_button"><i class = 'ui large secondary button'>Submit</i></div>
            </div>
        </div>
    </div>

    <script>

        $(document).ready(function(){
            $('.ui.language.dropdown')
                .dropdown()
            ;

            $('.problem.detail > .summary > .menu > .submit').click(function () {
                '{% if user.is_authenticated == True %}'
                    $('#submit_modal').modal('show');
                '{% else %}'
                    $('.login.modal' ).modal( 'show' );
                '{% endif %}'
            });
    
            $('.problem.detail > .summary > .menu > .edit').click(function () {
                window.location = '{{ url("problem-edit-view" , args = (prob.problem_id,) ) }} ';
            });
    
            $('#code_submit_button > .button').click(function(){
                var code = $('#code_textarea')["0"].value;
                var lang = $("#languagelist")[0].innerText;
                //alert( "Submit code is " + code + " Lang is " + lang );
                $(this)
                    .addClass( 'loading disabled' )
                ;
                var problemid = '{{prob.problem_id}}';
                $.ajaxSetup({
                    data: { csrfmiddlewaretoken: '{{ csrf_token }}' },
                });
                $.post(
                    '{{ url("submission-submit-solution") }}',
                    {
                        'problemid' : problemid,
                        'code' : code,
                        'language' : lang,
                    },
                    function(data,status){
                        if( status == 'success' ){
                            //alert(data.submission_id);
                        }
                        $('#code_submit_button > .button').
                            removeClass( 'loading disabled' )
                        ;
                    }
                )
            });                
        });
    </script>
{% endblock content %}