{% extends "base/base.html" %}

{% block extra_head %}
    <link href="{{ static('css/user/user_detail.css') }}" rel="stylesheet" />
{% endblock extra_head %}

{% block title %}
    <title> Lutece | {{ user.display_name }} </title>
{% endblock title %}

{% block content %}
    <div class = 'user detail'>

        <div class = 'ui grid segement'>


            <div class="ui three column grid">

                <div class = 'column'>

                    <div class = 'ui one column grid'>

                        <div class = 'column'>
                            <img class="ui small bordered image" src= {{ gravatar_url( email = user.email , size = 200 ) }} >
                            <span><a href = 'https://cn.gravatar.com/' ><i class = 'hand point right outline icon'></i>Want to change photo?</a></span>
                        </div>
                        
                        
                        <div class = 'column'>
                            <div class = 'label'><b>About</b></div>
                            <div class = 'ui form'>
                                <div class = 'field'>                                
                                    <textarea>{{ info.about }}</textarea>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>

                <div class = 'column'>

                    <div class = 'ui header'>Personal Information</div> 

                    <h5> Tell others how awesome you are </h5>
                    
                    <br/>

                    <div class = 'ui one column grid'>

                        <div class = 'column'>
                            <div class="label"><b>School</b></div>
                            <div class="ui fluid input">
                                <input type ="text" value= "{{ info.school }}" maxlength = 16 >
                            </div>
                        </div>

                        <div class = 'column'>
                            <div class="label"><b>Company</b></div>
                            <div class="ui fluid input">
                                <input type ="text" value= "{{ info.company }}" maxlength = 16 >
                            </div>
                        </div>

                        <div class = 'column'>
                            <div class="label"><b>Location</b></div>
                            <div class="ui fluid input">
                                <input type ="text" value= "{{ info.location }}" maxlength = 16 >
                            </div>
                        </div>

                        <div class = 'column'>
                            <div class = "label"><b>Display name</b></div>
                            <div class="ui  fluid input">
                                <input type ="text" value= "{{ user.display_name }}" maxlength = 16 >
                            </div>
                        </div>

                    </div>

                </div>

                <div class = 'three wide column'>
                    <div id="solve-analysis" style="width: 430px;height:410px;"></div>
                </div>
                
            </div>

        </div>

        <div class = 'ui two column grid'>
            <div class = 'column'>
                <div class = "label"><b>Detail</b></div>
                {% for x in analysis.result %}
                    {% if x.1 == True %}
                        <a href = {{ url('problem-detail-view' , args = (x.0,) )}} ><div class = 'ui tiny green button aligned center' tabindex="0" style = "width:60px;height:30px;margin-top:3px;" >{{x.0}}</div></a>
                    {% else %}
                        <a href = {{ url('problem-detail-view' , args = (x.0,) )}} ><div class = 'ui tiny red button aligned center' tabindex="0" style = "width:60px;height:30px;margin-top:3px;" >{{x.0}}</div></a>
                    {% endif %}
                {% endfor %}
            </div>

            <div class = 'column'>
                <div class = "label"><b>Recently</b></div>
                <table class = "ui basic fixed selectable padded table bordered" >
                    <thread>
                        <div class = 'status list menu'>
                            <tr>
                                <th>ID</th>
                                <th>When</th>
                                <th>Problem</th>
                                <th>Verdict</th>
                            </tr>
                        </div>
                    </thread>
                    <tbody>
                        {% for x in recently %}
                            <tr>
                                <td>{{ x.pk }}</td>
                                <td>{{ x.submit_time.strftime('%Y-%m-%d %H:%M')  }}</td>
                                <td><a href = {{ url('problem-detail-view' , args = (x.problem.problem_id,) ) }} >{{x.problem.title}}</td>
                                <td class = 'judge_info' >{{ x.judge_status }} </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class = 'ui primary button' style = "display:grid; margin-top:18px;" > Submit </div>

    </div>

    <script>

        $(document).ready(function(){
            var myChart = echarts.init(document.getElementById('solve-analysis'));
            var option = {
                aria: {
                    show: true
                },
                title: {
                    text: 'Summary',
                    x: 'center'
                },
                tooltip : {
                    trigger: 'item',
                    formatter: "{b} : {c} ({d}%)"
                },
                series : [
                    {
                        type: 'pie',
                        radius: '70%',
                        selectedMode: 'single',
                        rosetype: 'angle',
                        label: {
                            normal: {
                                show: false
                            },
                            emphasis: {
                                show: false
                            }
                        },
                        data:[
                            {% for name in analysis.summary %}
                                {% if analysis.summary[name] > 0 %}
                                    {
                                        value: {{ analysis.summary[name] }},
                                        name: '{{ name }}',
                                        itemStyle:{
                                            color: '{{ judge_color[name] }}',
                                        },
                                    },
                                {% endif %}
                            {% endfor %}
                        ]
                    }
                ]
            };
            myChart.setOption(option);
        });

        var process_queue = $('.user.detail .judge_info');
            for( let i = 0 ; i < process_queue.length ; ++ i){
                let j = process_queue[i];
                let k = j.innerText;
                if( k == "Accepted" ){
                    $(j).css( 'color' , 'green' )
                        .prepend( "<i class = 'check icon'</i>" );
                }else if( k == 'Waiting' || k == 'Preparing' ){
                    $(j).css( 'color' , 'grey' );
                }else if( k == 'Compile Error' || k == 'Judger Error' ){
                    $(j).css( 'color' , 'orange' )
                        .prepend( "<i class = 'exclamation icon'</i>" );
                }else if( k.substring( 0 , 7 ) == 'Running' ){
                    $(j).css( 'color' , 'black' )
                        .prepend( "<i class = 'sync icon'</i>" );
                }else{
                    $(j).css( 'color' , 'red' )
                        .prepend( "<i class = 'times icon'</i>" ); 
                }
            }

    </script>

{% endblock content %}