{% extends "base/base.html" %}

{% block extra_head %}
    <script type="text/javascript" src="{{ static('heatmap/dist/d3.min.js') }}"></script>
    <script type="text/javascript" src="{{ static('heatmap/dist/cal-heatmap.min.js') }}"></script>
    <link href="{{ static('heatmap/dist/cal-heatmap.css') }}" rel="stylesheet" />
{% endblock extra_head %}

{% block title %}
    <title> Lutece | {{ target_user.display_name }} </title>
{% endblock title %}

        {# <div style = 'margin-top:10px;'>
            <div><i class = 'university icon'></i> {{ info.school }} </div>
            <div><i class = 'shopping bag icon'></i>{{ info.company }} </div>
            <div><i class = 'map marker alternate icon'></i>{{ info.location }}</div>
            <div><i class="users icon"></i><b>12</b> Followers </div>
            <div>Joined in {{ target_user.date_joined.strftime( '%m,%Y' ) }} </div>
        </div> #}

{% block content %}
    <div class = 'user detail'>

        <div class = 'ui grid'>
            <div class = 'four wide column'>
                <div style = 'width:90%;'ã€€>
                    <div class = 'ui header'>Card </div>
                    <div class = 'ui card' style = 'width:auto;'>
                        <img class = 'ui image' style = 'width:200px;height:200px;' src= {{ gravatar_url( email = target_user.email , size = 200 ) }} />
                        <div class = 'content' >
                            <a class="header">{{ target_user.display_name }}</a>
                            <div class="meta" style = 'margin-top:5px;'>
                                <span>Last Seen {{target_user.last_login.strftime('%m,%d,%Y') }}</span>
                            </div>
                        </div>
                        <div class="extra content">
                            <div><i class = 'address book icon'></i>Joined in {{ target_user.date_joined.strftime( '%m,%Y' ) }} </div>
                            <div><i class="users icon"></i><b>0</b> Followers</div>
                        </div>
                        <div class = 'ui blue bottom attached button' onclick = 'alert("fuck")' > Follow </div>
                    </div>

                    <div class = ' ui raised segment' id = 'info-card' style = 'margin-top:30px;' >
                        <div ><i class = 'university icon'></i>{{ info.school }} </div>
                        <div style = 'margin-top:10px;'><i class = 'shopping bag icon'></i>{{ info.company }} </div>
                        <div style = 'margin-top:10px;'><i class = 'map marker alternate icon'></i>{{ info.location }}</div>
                        <div style = 'margin-top:10px;'><i class = 'tasks icon'></i><span style = 'color:green'> {{ info.solved  }}</span> / <span style = 'color:red;'> {{ info.tried  }}</span></div>
                    </div>
                </div>
            </div>

            <div class = 'twelve wide column'>
                <div class = 'ui header'>Activity </div>
                <div class = 'ui raised segment' id = 'cal-heatmap' style = 'position:relative' ></div>
                <div class = 'ui header'>Recently </div>
                <div class = 'one column grid'>
                    <div class="ui raised segment">
                        <div class = 'column'>
                            <table class = "ui basic fixed selectable padded table bordered" style = 'text-align:center;' >
                                <thread>
                                    <div class = 'status list menu'>
                                        <tr>
                                            <th>ID</th>
                                            <th>When</th>
                                            <th>Problem</th>
                                            <th>Verdict</th>
                                            <th>Language</th>                                    
                                        </tr>
                                    </div>
                                </thread>
                                <tbody>
                                    {% for x in recently %}
                                        <tr>
                                            <td><a href = {{ url('submission-status-detail' , args = (x.pk,) ) }}> {{ x.pk }}</a></td>
                                            <td>{{ x.submit_time.strftime('%Y-%m-%d %H:%M')  }}</td>
                                            <td><a href = {{ url('problem-detail-view' , args = (x.problem.problem_id,) ) }} >{{x.problem.title}}</td>
                                            <td style = 'color:{{  x.judge_status | get_judge_result_color }};'><i class = '{{ x.judge_status | get_judge_result_icon }} '></i>{{ x.judge_status }} </td>
                                            <td>{{ x.language }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            <div id = "user-detail-error" class="ui negative message transition hidden"></div>
                        </div>
                    </div>
                </div>

                <div class = 'ui header'>Detail</div>
                <div class = 'one column grid'>
                    <div class = 'column'>
                        <div class = 'ui raised segment' >
                            {% for x in result %}
                                {% if x.1 == True %}
                                    <a href = {{ url('problem-detail-view' , args = (x.0,) )}} ><div class = 'ui tiny green button aligned center' tabindex="0" style = "width:60px;height:30px;margin-top:10px;" >{{x.0}}</div></a>
                                {% else %}
                                    <a href = {{ url('problem-detail-view' , args = (x.0,) )}} ><div class = 'ui tiny red button aligned center' tabindex="0" style = "width:60px;height:30px;margin-top:10px;" >{{x.0}}</div></a>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

        </div>

    
    </div>

    <script>

        function getVirtulData(year) {
            var date = +echarts.number.parseDate(year + '-01-01');
            var end = +echarts.number.parseDate((+year + 1) + '-01-01');
            var dayTime = 3600 * 24 * 1000;
            var data = [];
            for (var time = date; time < end; time += dayTime) {
                data.push([
                    echarts.format.formatTime('yyyy-MM-dd', time),
                    Math.floor(Math.random()*10)
                ]);
            }
            return data;
        }

        var cal = new CalHeatMap();
        var previous_one_year = new Date();
        previous_one_year.setFullYear(previous_one_year.getFullYear() - 1);
        previous_one_year.setDate(previous_one_year.getDate()+1);
	    cal.init({
            domain: "month",
            subDomain: "day",
            tooltip: true,
            cellRadius : 3,
            domainGutter : 10,
            cellSize: 10,
            rowLimit: 7,
            label:{
                position : 'top',
                align: 'center',
            },
            legendHorizontalPosition: "right",
            start: previous_one_year,
            itemName: ['submission' , 'submissions'],
            data: "{{ url( 'submission-get-activity' , args = ( target_user.pk, ) ) }}"
        });


        $(document).ready(function(){
            {# var myChart = echarts.init(document.getElementById('solve-analysis'));
            var option = {
                aria: {
                    show: true
                },
                title: {
                    text: 'Summary',
                    x: 'center'
                },
                tooltip : {
                    trigger: 'item',
                    formatter: "{b} : {c} ({d}%)"
                },
                series : [
                    {
                        type: 'pie',
                        radius: '65%',
                        selectedMode: 'single',
                        rosetype: 'angle',
                        label: {
                            normal: {
                                show: true
                            },
                            emphasis: {
                                show: true
                            }
                        },
                        data:[
                            {% for each in analysis %}
                                {
                                    value: {{ analysis[each] }},
                                    name: '{{ each.value.full }}',
                                    itemStyle:{
                                        color: '{{ each.value.color }}',
                                    },
                                },
                            {% endfor %}
                        ]
                    }
                ]
            };
            myChart.setOption(option); #}
        });
        
        {% if user == target_user %}
            $('#user-detail-button').click(function(){
                var about = $('#about-info').val();
                var school = $('#school-info > input').val();
                var company = $('#company-info > input').val();
                var _location = $('#location-info > input').val();
                var display_name = $('#display_name-info > input').val();
                $(this).addClass( 'disabled loading' );
                $.ajaxSetup({
                    data: { csrfmiddlewaretoken: '{{ csrf_token }}' },
                });
                $.post(
                    '{{ url("user-infomodify") }}',
                    {
                        'about' : about,
                        'school' : school,
                        'company' : company,
                        'location' : _location,
                        'display_name' : display_name
                    },
                    function(data,status){
                        if( status == 'success'  && data.status == true ){
                            location.reload();
                        }else{
                            $('#user-detail-button')
                                .removeClass( 'loading disabled primary' )
                                .addClass('red')
                            ;
                            $('#user-detail-error')
                                .empty()
                                .removeClass( 'hidden' )
                                .append(get_error_msgText( data.error_msg ))
                            ;
                        }
                    }
                )
            });
        {% endif %}

    </script>

{% endblock content %}